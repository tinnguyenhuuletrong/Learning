(window["webpackJsonpwebrtc-playground"]=window["webpackJsonpwebrtc-playground"]||[]).push([[0],{24:function(e,t,n){e.exports=n(51)},43:function(e,t){},45:function(e,t){},51:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"ESTEP",function(){return d}),n.d(a,"ECLIENT_MODE",function(){return f}),n.d(a,"EACTION",function(){return p});var c=n(0),r=n.n(c),o=n(22),l=n.n(o),s=(n(29),n(1)),i=n(23),u=n(9),m=n(10),E=n.n(m),d={CHOICE_MODE:"CHOICE_MODE",NOT_CONNECT:"NOT_CONNECT",CONNECTED:"CONNECTED"},f={HOST:"HOST",PEER:"PEER"},p={reset:"reset",setAppStep:"setAppStep",setAppMode:"setAppMode",updateConenction:"updateConenction",updateWebRTCSupport:"updateWebRTCSupport"};function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach(function(t){Object(i.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v={supportWebRTC:!1,appStep:d.CHOICE_MODE,mode:"",connection:null,eventSource:new u.EventEmitter},N=function(e){return function(t,n){var a=e(t,n);return window.store=a,a}}(function(e,t){switch(console.log("action",t),t.type){case p.reset:return O({},v,{eventSource:new u.EventEmitter,supportWebRTC:E.a.isWebRTCSupported});case p.updateWebRTCSupport:return O({},e,{supportWebRTC:t.value});case p.setAppMode:return O({},e,{mode:t.value});case p.setAppStep:return O({},e,{appStep:t.value});case p.updateConenction:return O({},e,{connection:t.value});default:return e}}),C=Object(c.createContext)(),j=function(e){var t=e.children;return r.a.createElement(C.Provider,{value:Object(c.useReducer)(N,v)},t)},g=function(){return Object(c.useContext)(C)},S=a,T=function(e){var t=e.expectedAppStep,n=e.children,a=g(),c=Object(s.a)(a,1)[0].appStep,o=Array.isArray(t)?t:[t];return r.a.createElement(r.a.Fragment,null,o.includes(c)?n:null)},y=function(e){e.defaultIndex,e.tabs;var t=g(),n=Object(s.a)(t,2),a=n[0],o=a.appStep,l=a.mode,i=a.connection,u=n[1],m=Object(c.useCallback)(function(e){u({type:S.EACTION.setAppMode,value:e}),u({type:S.EACTION.setAppStep,value:S.ESTEP.NOT_CONNECT})},[u]),E=Object(c.useCallback)(function(){i&&i.destroy&&i.destroy(),u({type:S.EACTION.reset})},[u,i]),d=o===S.ESTEP.CHOICE_MODE?{disabled:!1}:{disabled:!0};return r.a.createElement("div",{className:"columns is-multiline"},r.a.createElement("div",{className:"column is-full"},r.a.createElement("fieldset",d,r.a.createElement("div",{className:"field is-grouped is-grouped-centered"},r.a.createElement("label",{className:"radio"},r.a.createElement("input",{type:"radio",checked:l===S.ECLIENT_MODE.HOST,onChange:function(e){return m(S.ECLIENT_MODE.HOST)}}),r.a.createElement("span",{style:{margin:5}},"Host")),r.a.createElement("label",{className:"radio"},r.a.createElement("input",{type:"radio",checked:l===S.ECLIENT_MODE.PEER,onChange:function(e){return m(S.ECLIENT_MODE.PEER)}}),r.a.createElement("span",{style:{margin:5}},"Peer"))))),r.a.createElement("div",{className:"column"},r.a.createElement("div",{className:"field is-grouped is-grouped-centered"},r.a.createElement(T,{expectedAppStep:[S.ESTEP.CONNECTED,S.ESTEP.NOT_CONNECT]},r.a.createElement("button",{className:"button is-warning",onClick:E},"Reset")))))},h=n(7),w=function(e,t,n){Object(c.useEffect)(function(){if(e){var a=function(e){return t.emit("error",e)},c=function(){t.emit("connect"),n({type:S.EACTION.setAppStep,value:S.ESTEP.CONNECTED})},r=function(){t.emit("close"),n({type:S.EACTION.setAppStep,value:S.ESTEP.NOT_CONNECT})},o=function(e){return t.emit("data",e)};return e.on("error",a),e.on("connect",c),e.on("data",o),e.on("close",r),function(){e.off("error",a),e.off("connect",c),e.off("data",o),e.off("close",r)}}},[e,t])},x=n(11),A=n.n(x),I=function(e){var t=g(),n=Object(s.a)(t,2),a=n[0],o=a.appStep,l=a.mode,i=a.connection,u=a.eventSource,m=n[1],E=Object(c.useState)(1),d=Object(s.a)(E,2),f=d[0],p=d[1],b=Object(c.useState)([]),O=Object(s.a)(b,2),v=O[0],N=O[1],C=Object(c.useState)(""),j=Object(s.a)(C,2),T=j[0],y=j[1],x=Object(c.useMemo)(function(){return{disabled:!(o===S.ESTEP.NOT_CONNECT&&l===S.ECLIENT_MODE.HOST)}},[o,l]);w(i,u,m),Object(c.useEffect)(function(){if(i){var e=function(e){var t=e;N([].concat(Object(h.a)(v),[t])),p(2)};return i.on("signal",e),function(){i.off("signal",e)}}},[i,v,N,p]);var I=Object(c.useCallback)(function(){var e=new A.a({initiator:!0});m({type:S.EACTION.updateConenction,value:e})},[m]),P=Object(c.useCallback)(function(){try{console.log("submit answer",T);var e=JSON.parse(T);if(!Array.isArray(e))throw new Error("Input signal must be aray");e.forEach(function(e){return i.signal(e)})}catch(t){console.error(t)}},[T,i]);return r.a.createElement("fieldset",x,r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Host Signal Data"),r.a.createElement("div",{className:["control",v?"":"is-loading"].join(" ")},r.a.createElement("textarea",{className:["textarea","is-small"].join(" "),readOnly:!0,value:JSON.stringify(v)}))),1===f&&r.a.createElement("div",{className:"field"},r.a.createElement("button",{className:"button is-primary",onClick:I},"Generate")),f>=2&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Answer"),r.a.createElement("div",{className:["control"].join(" ")},r.a.createElement("textarea",{className:["textarea","is-small"].join(" "),value:T,onChange:function(e){return y(e.target.value)}}))),r.a.createElement("div",{className:"field"},r.a.createElement("button",{className:"button is-primary",onClick:P},"Connect"))))},P=function(e){var t=g(),n=Object(s.a)(t,2),a=n[0],o=a.appStep,l=a.mode,i=a.connection,u=a.eventSource,m=n[1],E=Object(c.useState)(1),d=Object(s.a)(E,2),f=d[0],p=d[1],b=Object(c.useState)(""),O=Object(s.a)(b,2),v=O[0],N=O[1],C=Object(c.useState)([]),j=Object(s.a)(C,2),T=j[0],y=j[1],x=Object(c.useMemo)(function(){return{disabled:!(o===S.ESTEP.NOT_CONNECT&&l===S.ECLIENT_MODE.PEER)}},[o,l]);w(i,u,m),Object(c.useEffect)(function(){if(i){var e=function(e){var t=e;y([].concat(Object(h.a)(T),[t])),p(2)};return i.on("signal",e),function(){i.off("signal",e)}}},[i,T,p]);var I=Object(c.useCallback)(function(){console.log("begin connect ",v);var e=new A.a({initiator:!1,trickle:!1});try{var t=JSON.parse(v);if(!Array.isArray(t))throw new Error("Input signal must be aray");t.forEach(function(t){return e.signal(t)}),m({type:S.EACTION.updateConenction,value:e})}catch(n){console.error(n)}},[v,m]);return r.a.createElement("fieldset",x,r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"SignalData from Host"),r.a.createElement("div",{className:["control"].join(" ")},r.a.createElement("textarea",{className:["textarea","is-small"].join(" "),value:v,onChange:function(e){return N(e.target.value)}}))),1===f&&r.a.createElement("div",{className:"field"},r.a.createElement("button",{className:"button is-primary",onClick:I},"Connect")),2===f&&r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Answer To Host"),r.a.createElement("div",{className:["control"].join(" ")},r.a.createElement("textarea",{className:["textarea","is-small"].join(" "),readOnly:!0,value:JSON.stringify(T)}))))},k={connecting:"is-link",connected:"is-primary",error:"is-danger",disconnected:"is-warning"},D=function(e){e.defaultIndex,e.tabs;var t=g(),n=Object(s.a)(t,1)[0].eventSource,a=Object(c.useState)("connecting"),o=Object(s.a)(a,2),l=o[0],i=o[1];return Object(c.useEffect)(function(){var e=function(e){return i(e)};n.on("connect",function(t){return e("connected")}),n.on("close",function(t){return e("disconnected")}),n.on("error",function(t){return e("error")})},[n]),r.a.createElement("article",{className:["message",k[l]].join(" ")},r.a.createElement("div",{className:"message-body"},r.a.createElement("p",{className:"is-capitalized"},l)))},M=function(e){e.defaultIndex,e.tabs;var t=g(),n=Object(s.a)(t,1)[0].eventSource,a=Object(c.useState)([]),o=Object(s.a)(a,2),l=o[0],i=o[1];return Object(c.useEffect)(function(){var e=function(e){return function(){i([].concat(Object(h.a)(l),[{_time:new Date,content:e}]))}},t=e("connected"),a=e("error"),c=e("disconnected"),r=function(t){return e("Recv -> ".concat(t))()};return n.on("connect",t),n.on("error",a),n.on("data",r),n.on("close",c),n.on("action-send-text",function(t){return e("Send -> ".concat(t))()}),function(){n.off("connect",t),n.off("error",a),n.off("data",r),n.off("close",c)}},[l,i,n]),r.a.createElement("div",{className:"column is-full"},r.a.createElement("div",{className:"container has-background-grey-lighter is-size-7",style:{minHeight:"50vh",maxHeight:"50vh",overflowY:"auto",padding:"5px 10px"}},l.map(function(e,t){var n=e.content,a=e._time;return r.a.createElement("p",{key:t},String(a)," - ",String(n))})))},_=function(e){e.defaultIndex,e.tabs;var t=g(),n=Object(s.a)(t,1)[0],a=n.eventSource,o=n.connection,l=Object(c.useState)(!1),i=Object(s.a)(l,2),u=i[0],m=i[1],E=Object(c.useState)([]),d=Object(s.a)(E,2),f=d[0],p=d[1];Object(c.useEffect)(function(){var e=function(){return m(!0)},t=function(){return m(!1)};return a.on("connect",e),a.on("close",t),function(){a.off("connect",e),a.off("close",t)}},[a,m]);var b=Object(c.useCallback)(function(e){return p(e)},[p]),O=Object(c.useCallback)(function(){o.send(f),a.emit("action-send-text",f),b("")},[f,o,a,b]);return r.a.createElement("fieldset",{disabled:!u},r.a.createElement("div",{className:"columns"},r.a.createElement("div",{className:"column is-11"},r.a.createElement("input",{className:"input",type:"text",placeholder:"message to send",value:f,onChange:function(e){return b(e.target.value)},onKeyPress:function(e){e||(e=window.event);var t=e.keyCode||e.which;if("13"===String(t))return O(e.target.value),!1}})),r.a.createElement("div",{className:"column"},r.a.createElement("button",{className:"button is-info",onClick:O},"Send"))))},R=function(e){e.expectedMode;var t=e.children,n=g(),a=Object(s.a)(n,2),o=a[0].supportWebRTC,l=a[1],i=Object(c.useState)(!0),u=Object(s.a)(i,2),m=u[0],d=u[1];return Object(c.useEffect)(function(){E.a.load(function(){l({type:S.EACTION.updateWebRTCSupport,value:E.a.isWebRTCSupported}),d(!1)})},[l]),r.a.createElement(r.a.Fragment,null,m?null:o?t:r.a.createElement("article",{class:"message is-danger"},r.a.createElement("div",{class:"message-body"},"Browser don't support WebRTC")))},H=function(e){var t=e.expectedMode,n=e.children,a=g(),c=Object(s.a)(a,1)[0].mode;return r.a.createElement(r.a.Fragment,null,t===c?n:null)};var W=function(){return r.a.createElement(j,null,r.a.createElement("section",{className:"section "},r.a.createElement("div",{className:"container"},r.a.createElement("section",{className:"hero"},r.a.createElement("div",{className:"hero-body"},r.a.createElement("div",{className:"container"},r.a.createElement("h1",{className:"title"},"Web RTC Playground")))),r.a.createElement(R,null,r.a.createElement("p",{className:"has-text-centered is-size-3"},"Start here !"),r.a.createElement("div",{className:"column"},r.a.createElement("div",{className:"box"},r.a.createElement(y,null))),r.a.createElement(H,{expectedMode:S.ECLIENT_MODE.HOST},r.a.createElement("div",{className:"column"},r.a.createElement("div",{className:"box"},r.a.createElement(I,null)))),r.a.createElement(H,{expectedMode:S.ECLIENT_MODE.PEER},r.a.createElement("div",{className:"column"},r.a.createElement("div",{className:"box"},r.a.createElement(P,null)))),r.a.createElement("div",{className:"column"},r.a.createElement(D,null)),r.a.createElement("div",{className:"column is-multiline"},r.a.createElement("div",{className:"box"},r.a.createElement(M,null)),r.a.createElement("div",{className:"box"},r.a.createElement(_,null)))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[24,1,2]]]);
//# sourceMappingURL=main.cf17e423.chunk.js.map