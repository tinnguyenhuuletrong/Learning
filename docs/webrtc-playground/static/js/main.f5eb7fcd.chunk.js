(window["webpackJsonpwebrtc-playground"]=window["webpackJsonpwebrtc-playground"]||[]).push([[0],{34:function(e,t,a){e.exports=a(67)},57:function(e,t){},59:function(e,t){},67:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"ESTEP",function(){return p}),a.d(n,"ECLIENT_MODE",function(){return b}),a.d(n,"EACTION",function(){return O});var r=a(0),c=a.n(r),o=a(31),l=a.n(o),s=(a(39),a(1)),i=a(8),u=a(12),m=a(13),f=a.n(m),d=a(17),E=a.n(d),p=(a(40),{CHOICE_MODE:"CHOICE_MODE",NOT_CONNECT:"NOT_CONNECT",CONNECTED:"CONNECTED"}),b={HOST:"HOST",PEER:"PEER"},O={reset:"reset",setAppStep:"setAppStep",setRoomId:"setRoomId",setAppMode:"setAppMode",setMineMedia:"setMineMedia",updateConenction:"updateConenction",updateWebRTCSupport:"updateWebRTCSupport"};function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(a,!0).forEach(function(t){Object(i.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}E.a.initializeApp({apiKey:"AIzaSyBe719lkdeQBL0McXykgBMUClMUN3UgpUQ",databaseURL:"https://weeklyhack-ff068.firebaseio.com/"});var j={supportWebRTC:!1,appStep:p.CHOICE_MODE,roomId:"room-".concat(Date.now()),mode:"",mineMedia:null,connection:null,eventSource:new u.EventEmitter,firebaseDatabase:E.a.database()},g=function(e){return function(t,a){var n=e(t,a);return window.store=n,n}}(function(e,t){switch(console.log("action",t),t.type){case O.reset:var a=e.mineMedia;return a&&a.getTracks().forEach(function(e){return e.stop()}),N({},j,{mineMedia:null,eventSource:new u.EventEmitter,supportWebRTC:f.a.isWebRTCSupported});case O.updateWebRTCSupport:return N({},e,{supportWebRTC:t.value});case O.setAppMode:return N({},e,{mode:t.value});case O.setRoomId:return N({},e,{roomId:t.value});case O.setAppStep:return N({},e,{appStep:t.value});case O.setMineMedia:return N({},e,{mineMedia:t.value});case O.updateConenction:return N({},e,{connection:t.value});default:return e}}),y=Object(r.createContext)(),C=function(e){var t=e.children;return c.a.createElement(y.Provider,{value:Object(r.useReducer)(g,j)},t)},S=function(){return Object(r.useContext)(y)},h=n,T=function(e){var t=e.expectedAppStep,a=e.children,n=S(),r=Object(s.a)(n,1)[0].appStep,o=Array.isArray(t)?t:[t];return c.a.createElement(c.a.Fragment,null,o.includes(r)?a:null)},w=a(3),I={video:!0},k=function(e){e.defaultIndex,e.tabs;var t=S(),a=Object(s.a)(t,2),n=a[0],o=n.appStep,l=n.mode,i=n.roomId,u=n.connection,m=a[1],f=Object(r.useCallback)(function(e){m({type:h.EACTION.setAppMode,value:e}),m({type:h.EACTION.setAppStep,value:h.ESTEP.NOT_CONNECT})},[m]),d=Object(r.useCallback)(function(){u&&u.destroy&&u.destroy(),m({type:h.EACTION.reset})},[m,u]),E=Object(r.useCallback)(function(e){m({type:h.EACTION.setRoomId,value:e})},[m]),p=Object(r.useCallback)(function(){navigator.getUserMedia(I,function(e){m({type:h.EACTION.setMineMedia,value:e})},function(e){Object(w.toast)({message:"error - ".concat(e.message),type:"is-error",animate:{in:"fadeIn",out:"fadeOut"}})})},[m]),b=o===h.ESTEP.CHOICE_MODE?{disabled:!1}:{disabled:!0};return c.a.createElement("div",{className:"columns is-multiline is-centered"},c.a.createElement("div",{className:"column is-6"},c.a.createElement("fieldset",b,c.a.createElement("input",{className:"input is-rounded",type:"text",value:i,onChange:function(e){return E(e.target.value)},placeholder:"Room Id"}))),c.a.createElement("div",{className:"column is-full"},c.a.createElement("fieldset",b,c.a.createElement("div",{className:"field is-grouped is-grouped-centered"},c.a.createElement("button",{className:"button is-success",onClick:p},"With Media")))),c.a.createElement("div",{className:"column is-full"},c.a.createElement("fieldset",b,c.a.createElement("div",{className:"field is-grouped is-grouped-centered"},c.a.createElement("label",{className:"radio"},c.a.createElement("input",{type:"radio",checked:l===h.ECLIENT_MODE.HOST,onChange:function(e){return f(h.ECLIENT_MODE.HOST)}}),c.a.createElement("span",{style:{margin:5}},"Host")),c.a.createElement("label",{className:"radio"},c.a.createElement("input",{type:"radio",checked:l===h.ECLIENT_MODE.PEER,onChange:function(e){return f(h.ECLIENT_MODE.PEER)}}),c.a.createElement("span",{style:{margin:5}},"Peer"))))),c.a.createElement("div",{className:"column"},c.a.createElement("div",{className:"field is-grouped is-grouped-centered"},c.a.createElement(T,{expectedAppStep:[h.ESTEP.CONNECTED,h.ESTEP.NOT_CONNECT]},c.a.createElement("button",{className:"button is-warning",onClick:d},"Reset")))))},P=a(10),x=a(9),M=a.n(x),R=a(14),D=a.n(R),A=function(e){var t=e.onChange,a=Object(r.useState)('{\n    "trickle": true,\n    "config": {\n      "iceServers": [ { "urls": "stun:stun.l.google.com:19302" }, { "urls": "stun:global.stun.twilio.com:3478?transport=udp" } ]\n    }\n  }'),n=Object(s.a)(a,2),o=n[0],l=n[1],i=Object(r.useState)(!0),u=Object(s.a)(i,2),m=u[0],f=u[1];return Object(r.useEffect)(function(){t&&t(JSON.parse(o))},[]),c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"STUN/TURN config"," ",c.a.createElement("span",{className:["icon",m?"has-text-success":"has-text-danger"].join(" ")},c.a.createElement("i",{className:["fas",m?"fa-check":"fa-ban"].join(" ")}))),c.a.createElement("div",{className:["control"].join(" ")},c.a.createElement("textarea",{className:["textarea","is-small"].join(" "),defaultValue:o,onChange:function(e){try{l(e.target.value);var a=JSON.parse(e.target.value);t&&t(a),f(!0)}catch(n){f(!1)}}})))},_=function(e,t,a){Object(r.useEffect)(function(){if(e){var n=function(e){return t.emit("error",e)},r=function(){t.emit("connect"),a({type:h.EACTION.setAppStep,value:h.ESTEP.CONNECTED})},c=function(){t.emit("close"),a({type:h.EACTION.setAppStep,value:h.ESTEP.NOT_CONNECT})},o=function(e){return t.emit("data",e)};return e.on("error",n),e.on("connect",r),e.on("data",o),e.on("close",c),e.on("stream",function(e){return console.log("stream",e)}),function(){e.off("error",n),e.off("connect",r),e.off("data",o),e.off("close",c)}}},[e,t])};function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function W(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(a,!0).forEach(function(t){Object(i.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var L=function(e){var t=S(),a=Object(s.a)(t,2),n=a[0],o=n.appStep,l=n.roomId,i=n.mode,u=n.mineMedia,m=n.connection,f=n.eventSource,d=n.firebaseDatabase,E=a[1],p=Object(r.useState)(1),b=Object(s.a)(p,2),O=b[0],v=b[1],N=Object(r.useReducer)(function(e,t){return[].concat(Object(P.a)(e),[t])},[]),j=Object(s.a)(N,2),g=j[0],y=j[1],C=Object(r.useState)(""),T=Object(s.a)(C,2),I=T[0],k=T[1],x=Object(r.useReducer)(function(e,t){return W({},e,{},t)},{}),R=Object(s.a)(x,2),H=R[0],L=R[1],U=Object(r.useMemo)(function(){return{disabled:!(o===h.ESTEP.NOT_CONNECT&&i===h.ECLIENT_MODE.HOST)}},[o,i]);_(m,f,E);var J=Object(r.useCallback)(function(){console.log("Create peer with",H);var e=new M.a(W({initiator:!0,stream:u||!1},H));e.on("signal",function(e){y(e)}),v(2),E({type:h.EACTION.updateConenction,value:e})},[E,u,H]);Object(r.useEffect)(function(){var e="/room/".concat(l,"/answer"),t=d.ref(e),a=function(e){var t=(e.val()||{}).data;t&&(k(t),Object(w.toast)({message:"answer - sync from firebase",type:"is-info",animate:{in:"fadeIn",out:"fadeOut"}}))};return t.on("value",a),function(){t.off("value",a)}},[l,d,k]);var B=Object(r.useCallback)(function(){try{console.log("submit answer",I);var e=JSON.parse(I);if(!Array.isArray(e))throw new Error("Input signal must be aray");e.forEach(function(e){return m.signal(e)})}catch(t){console.error(t)}},[I,m]),z=Object(r.useCallback)(function(){var e,t=JSON.stringify(g);e=t,D()(e),Object(w.toast)({message:"copied - sync with firebase",type:"is-info",animate:{in:"fadeIn",out:"fadeOut"}});var a="/room/".concat(l,"/hostSignal");d.ref(a).set({data:t})},[g,l,d]),F=Object(r.useCallback)(function(e){L(e)},[L]);return c.a.createElement("fieldset",U,c.a.createElement(A,{onChange:F}),c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"Host Signal Data"," ",c.a.createElement("a",{className:"button is-rounded is-small",onClick:z},c.a.createElement("i",{className:"far fa-clipboard"}))),c.a.createElement("div",{className:["control",g?"":"is-loading"].join(" ")},c.a.createElement("textarea",{className:["textarea","is-small"].join(" "),readOnly:!0,value:JSON.stringify(g)}))),1===O&&c.a.createElement("div",{className:"field"},c.a.createElement("button",{className:"button is-primary",onClick:J},"Generate")),O>=2&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"Answer"),c.a.createElement("div",{className:["control"].join(" ")},c.a.createElement("textarea",{className:["textarea","is-small"].join(" "),value:I,onChange:function(e){return k(e.target.value)}}))),c.a.createElement("div",{className:"field"},c.a.createElement("button",{className:"button is-primary",onClick:B},"Connect"))))};function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(a,!0).forEach(function(t){Object(i.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var B=function(e){var t=S(),a=Object(s.a)(t,2),n=a[0],o=n.appStep,l=n.mode,i=n.mineMedia,u=n.roomId,m=n.connection,f=n.eventSource,d=n.firebaseDatabase,E=a[1],p=Object(r.useState)(1),b=Object(s.a)(p,2),O=b[0],v=b[1],N=Object(r.useState)(""),j=Object(s.a)(N,2),g=j[0],y=j[1],C=Object(r.useReducer)(function(e,t){return[].concat(Object(P.a)(e),[t])},[]),T=Object(s.a)(C,2),I=T[0],k=T[1],x=Object(r.useReducer)(function(e,t){return J({},e,{},t)},{}),R=Object(s.a)(x,2),H=R[0],W=R[1],L=Object(r.useMemo)(function(){return{disabled:!(o===h.ESTEP.NOT_CONNECT&&l===h.ECLIENT_MODE.PEER)}},[o,l]);_(m,f,E),Object(r.useEffect)(function(){var e="/room/".concat(u,"/hostSignal"),t=d.ref(e),a=function(e){console.log("aaaa",e);var t=(e.val()||{}).data;t&&(y(t),Object(w.toast)({message:"host - sync from firebase",type:"is-info",animate:{in:"fadeIn",out:"fadeOut"}}))};return t.on("value",a),function(){t.off("value",a)}},[u,d,y]);var U=Object(r.useCallback)(function(){console.log("Create peer with",H),console.log("begin connect ",g);var e=new M.a(J({initiator:!1,stream:i||!1},H));e.on("signal",function(e){k(e)});try{var t=JSON.parse(g);if(!Array.isArray(t))throw new Error("Input signal must be aray");t.forEach(function(t){return e.signal(t)}),v(2),E({type:h.EACTION.updateConenction,value:e})}catch(a){console.error(a)}},[g,k,v,E,i,H]),B=Object(r.useCallback)(function(){var e,t=JSON.stringify(I);e=t,D()(e),Object(w.toast)({message:"copied - sync with firebase",type:"is-info",animate:{in:"fadeIn",out:"fadeOut"}});var a="/room/".concat(u,"/answer");d.ref(a).set({data:t})},[I,d,u]),z=Object(r.useCallback)(function(e){W(e)},[W]);return c.a.createElement("fieldset",L,c.a.createElement(A,{onChange:z}),c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"SignalData from Host"),c.a.createElement("div",{className:["control"].join(" ")},c.a.createElement("textarea",{className:["textarea","is-small"].join(" "),value:g,onChange:function(e){return y(e.target.value)}}))),1===O&&c.a.createElement("div",{className:"field"},c.a.createElement("button",{className:"button is-primary",onClick:U},"Connect")),2===O&&c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"Answer To Host"," ",c.a.createElement("a",{className:"button is-rounded is-small",onClick:B},c.a.createElement("i",{className:"far fa-clipboard"}))),c.a.createElement("div",{className:["control"].join(" ")},c.a.createElement("textarea",{className:["textarea","is-small"].join(" "),readOnly:!0,value:JSON.stringify(I)}))))},z={connecting:"is-link",connected:"is-primary",error:"is-danger",disconnected:"is-warning"},F=function(e){e.defaultIndex,e.tabs;var t=S(),a=Object(s.a)(t,1)[0].eventSource,n=Object(r.useState)("connecting"),o=Object(s.a)(n,2),l=o[0],i=o[1];return Object(r.useEffect)(function(){var e=function(e){return i(e)};a.on("connect",function(t){return e("connected")}),a.on("close",function(t){return e("disconnected")}),a.on("error",function(t){return e("error")})},[a]),c.a.createElement("article",{className:["message",z[l]].join(" ")},c.a.createElement("div",{className:"message-body"},c.a.createElement("p",{className:"is-capitalized"},l)))},K=a(18),Q=a.n(K),Y=a(33),G=a(32),V=function(e){e.defaultIndex,e.tabs;var t=S(),a=Object(s.a)(t,1)[0],n=a.eventSource,o=a.connection,l=Object(r.useState)([]),i=Object(s.a)(l,2),u=i[0],m=i[1],f=Object(r.useState)([]),d=Object(s.a)(f,2),E=d[0],p=d[1];return Object(r.useEffect)(function(){if(o){var e=setInterval(Object(G.a)(Q.a.mark(function t(){return Q.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=2;break}return t.abrupt("return",clearInterval(e));case 2:o.getStats(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];p(t.map(function(e){return{type:e.type,id:e.id,timestamp:e.timestamp,others:Object(Y.a)(e,["type","id","timestamp"])}}))});case 3:case"end":return t.stop()}},t)})),1e3);return function(){return clearInterval(e)}}},[o]),Object(r.useEffect)(function(){var e=function(e){return function(){m([].concat(Object(P.a)(u),[{_time:new Date,content:e}]))}},t=e("connected"),a=e("error"),r=e("disconnected"),c=function(t){return e("Recv -> ".concat(t))()};return n.on("connect",t),n.on("error",a),n.on("data",c),n.on("close",r),n.on("action-send-text",function(t){return e("Send -> ".concat(t))()}),function(){n.off("connect",t),n.off("error",a),n.off("data",c),n.off("close",r)}},[u,m,n]),c.a.createElement("div",{className:"column is-full"},c.a.createElement("h3",null,"RTC Status Logs - ",E.length),c.a.createElement("div",{className:"container has-background-white-bis is-size-7",style:{minHeight:"50vh",maxHeight:"50vh",overflowY:"auto",padding:"5px 10px"}},E.map(function(e,t){var a=e.type,n=e.id,r=(e.timestamp,e.others);return c.a.createElement("div",{className:"content",key:n},c.a.createElement("p",null,t,") Type: ",c.a.createElement("strong",null,String(a))," - Id: ",String(n)),c.a.createElement("ul",null,Object.keys(r).map(function(e,t){return c.a.createElement("li",{key:t},String(e),": ",String(r[e]))})))})),c.a.createElement("hr",null),c.a.createElement("div",{className:"container has-background-grey-lighter is-size-7",style:{minHeight:"50vh",maxHeight:"50vh",overflowY:"auto",padding:"5px 10px"}},u.map(function(e,t){var a=e.content,n=e._time;return c.a.createElement("p",{key:t},String(n)," - ",String(a))})))},X=function(e){e.defaultIndex,e.tabs;var t=S(),a=Object(s.a)(t,1)[0],n=a.eventSource,o=a.connection,l=Object(r.useState)(!1),i=Object(s.a)(l,2),u=i[0],m=i[1],f=Object(r.useState)([]),d=Object(s.a)(f,2),E=d[0],p=d[1];Object(r.useEffect)(function(){var e=function(){return m(!0)},t=function(){return m(!1)};return n.on("connect",e),n.on("close",t),function(){n.off("connect",e),n.off("close",t)}},[n,m]);var b=Object(r.useCallback)(function(e){return p(e)},[p]),O=Object(r.useCallback)(function(){o.send(E),n.emit("action-send-text",E),b("")},[E,o,n,b]);return c.a.createElement("fieldset",{disabled:!u},c.a.createElement("div",{className:"columns"},c.a.createElement("div",{className:"column is-11"},c.a.createElement("input",{className:"input",type:"text",placeholder:"message to send",value:E,onChange:function(e){return b(e.target.value)},onKeyPress:function(e){e||(e=window.event);var t=e.keyCode||e.which;if("13"===String(t))return O(e.target.value),!1}})),c.a.createElement("div",{className:"column"},c.a.createElement("button",{className:"button is-info",onClick:O},"Send"))))},$=function(e){var t=e.stream,a=Object(r.useRef)(null);return Object(r.useEffect)(function(){if(a.current&&t){var e=a.current;"srcObject"in e?e.srcObject=t:e.src=window.URL.createObjectURL(t),e.play()}},[t]),c.a.createElement(c.a.Fragment,null,c.a.createElement("video",{ref:a}))},q=function(e){var t=S(),a=Object(s.a)(t,1)[0],n=a.eventSource,o=a.mineMedia,l=a.connection,i=Object(r.useState)(!1),u=Object(s.a)(i,2),m=(u[0],u[1]),f=Object(r.useState)(null),d=Object(s.a)(f,2),E=d[0],p=d[1];return Object(r.useEffect)(function(){var e=function(){return m(!0)},t=function(){return m(!1)};return n.on("connect",e),n.on("close",t),function(){n.off("connect",e),n.off("close",t)}},[n,m]),Object(r.useEffect)(function(){if(l){var e=function(e){Object(w.toast)({message:"video stream recived",type:"is-info",animate:{in:"fadeIn",out:"fadeOut"}}),p(e)};return l.on("stream",e),function(){l.off("stream",e)}}},[l,p]),c.a.createElement("fieldset",null,c.a.createElement("div",{className:"columns is-multiline is-centered"},c.a.createElement("div",{className:"column is-12"},c.a.createElement("div",{className:"columns is-centered"},c.a.createElement("div",{className:"column is-6"},c.a.createElement("p",null,"Me"),c.a.createElement($,{stream:o})),c.a.createElement("div",{className:"column is-6"},c.a.createElement("p",null,"Other"),c.a.createElement($,{stream:E}))))))},Z=function(e){e.expectedMode;var t=e.children,a=S(),n=Object(s.a)(a,2),o=n[0].supportWebRTC,l=n[1],i=Object(r.useState)(!0),u=Object(s.a)(i,2),m=u[0],d=u[1];return Object(r.useEffect)(function(){f.a.load(function(){l({type:h.EACTION.updateWebRTCSupport,value:f.a.isWebRTCSupported}),d(!1)})},[l]),c.a.createElement(c.a.Fragment,null,m?null:o&&M.a.WEBRTC_SUPPORT?t:c.a.createElement("article",{class:"message is-danger"},c.a.createElement("div",{class:"message-body"},"Browser don't support WebRTC")))},ee=function(e){var t=e.expectedMode,a=e.children,n=S(),r=Object(s.a)(n,1)[0].mode;return c.a.createElement(c.a.Fragment,null,t===r?a:null)};var te=function(){return c.a.createElement(C,null,c.a.createElement("section",{className:"section "},c.a.createElement("div",{className:"container"},c.a.createElement("section",{className:"hero"},c.a.createElement("div",{className:"hero-body"},c.a.createElement("div",{className:"container"},c.a.createElement("h1",{className:"title"},"Web RTC Playground")))),c.a.createElement(Z,null,c.a.createElement("p",{className:"has-text-centered is-size-3"},"Start here !"),c.a.createElement("div",{className:"column"},c.a.createElement("div",{className:"box"},c.a.createElement(k,null))),c.a.createElement(ee,{expectedMode:h.ECLIENT_MODE.HOST},c.a.createElement("div",{className:"column"},c.a.createElement("div",{className:"box"},c.a.createElement(L,null)))),c.a.createElement(ee,{expectedMode:h.ECLIENT_MODE.PEER},c.a.createElement("div",{className:"column"},c.a.createElement("div",{className:"box"},c.a.createElement(B,null)))),c.a.createElement("div",{className:"column"},c.a.createElement(F,null)),c.a.createElement("div",{className:"column is-multiline"},c.a.createElement("div",{className:"box"},c.a.createElement(V,null)),c.a.createElement("div",{className:"box"},c.a.createElement(X,null)),c.a.createElement("div",{className:"box"},c.a.createElement(q,null)))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[34,1,2]]]);
//# sourceMappingURL=main.f5eb7fcd.chunk.js.map